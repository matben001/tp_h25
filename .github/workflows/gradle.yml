name: CI

on:
  push:
    branches:
      - master
      - 'branch-*'
  pull_request:
  workflow_dispatch:

env:
  CIRRUS_SHELL: bash
  CIRRUS_CLONE_DEPTH: 0
  GRADLE_USER_HOME: ${{ github.workspace }}/.gradle
  FETCH_DEPTH: --depth=1
  BUILD_NUMBER: 1
  


jobs:


  build:
    runs-on: ubuntu-latest
    container:
      image: docker.io/library/gradle:7.5.1-jdk17
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Set Execute Permission for Build Script
        run: chmod +x .github/workflows/git-build.sh
      - name: Build Project
        run: .github/workflows/git-build.sh
      - name: Store Build Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: build-artifacts
          path: '**/build/libs/*.jar'
  junit:
    runs-on: ubuntu-latest
    container:
      image: docker.io/library/gradle:7.5.1-jdk17
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Set Execute Permission for Build Script
        run: chmod +x .github/workflows/git-junit.sh
      - name: Run JUnit Tests
        run: .github/workflows/git-junit.sh
      - name: Upload JUnit Test Results
        uses: actions/upload-artifact@v4
        with:
          name: junit-results
          path: '**/build/test-results/**/*.xml'

